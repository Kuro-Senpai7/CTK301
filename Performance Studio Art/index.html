<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>AR.js Relative Positioning</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>
  <style>
    body { margin: 0; }
    #container { width: 100vw; height: 100vh; }
  </style>
</head>
<body>
  <div id="container">
    <a-scene embedded arjs>
      <!-- Use a dummy marker or just start with an empty scene -->
      <a-entity id="camera" camera></a-entity>

      <!-- 3D object and text to be placed relative to starting point -->
      <a-entity id="object" geometry="primitive: box" material="color: red" position="0 0.5 -3"></a-entity>
      <a-entity id="text" text="value: Hello, AR!; color: white; align: center" position="0 1 -3"></a-entity>
    </a-scene>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      let startingPosition = null;
      const cameraEl = document.querySelector('#camera');

      // Function to capture the starting position of the camera
      function captureStartingPosition() {
        if (startingPosition === null) {
          startingPosition = cameraEl.getAttribute('position');
          console.log('Starting position:', startingPosition);
        }
      }

      // Function to update objects' positions relative to the starting position
      function updateRelativePositions() {
        if (startingPosition !== null) {
          const cameraPosition = cameraEl.getAttribute('position');

          // Calculate relative positions
          const objectEl = document.querySelector('#object');
          const textEl = document.querySelector('#text');

          objectEl.setAttribute('position', {
            x: objectEl.getAttribute('position').x - (cameraPosition.x - startingPosition.x),
            y: objectEl.getAttribute('position').y - (cameraPosition.y - startingPosition.y),
            z: objectEl.getAttribute('position').z - (cameraPosition.z - startingPosition.z)
          });

          textEl.setAttribute('position', {
            x: textEl.getAttribute('position').x - (cameraPosition.x - startingPosition.x),
            y: textEl.getAttribute('position').y - (cameraPosition.y - startingPosition.y),
            z: textEl.getAttribute('position').z - (cameraPosition.z - startingPosition.z)
          });
        }
      }

      document.querySelector('a-scene').addEventListener('loaded', () => {
        // Capture the starting position once the scene is loaded
        captureStartingPosition();
        setInterval(updateRelativePositions, 100); // Update positions every 100ms
      });
    });
  </script>
</body>
</html>
